<link rel="stylesheet" href="__PUBLIC__/assets/css/chosen.css" />
<script src="__PUBLIC__/assets/js/chosen.jquery.min.js"></script>
<import type='css' file="css.lightbox" />
<import file="js.lightbox" />
	<div class="breadcrumbs" id="breadcrumbs">
		<script type="text/javascript">
			try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
		</script>

		<style>
		.centerbox{
			width: 100%;
		}
		.fileinput-button input {
		    position: absolute;
		    top: 0;
		    right: 0;
		    margin: 0;
		    opacity: 0;
		    -ms-filter: 'alpha(opacity=0)';
		    font-size: 200px;
		    direction: ltr;
		    cursor: pointer;
		}
		.fileinput-button {
		    position: relative;
		    overflow: hidden;
		}
		.span2{
		    padding: 2px;
		    border: 1px solid #DEDEDE;
		    margin-bottom: 5px;
		}
		.span2 p{
		    margin-top: 3px;
		    margin-bottom: 3px;
		}
		</style>
		<ul class="breadcrumb">
			<li>
				<i class="icon-home home-icon"></i>
				<a href="{:U('Index/index')}">首页</a>
			</li>
			<li class="active">留言管理</li>
		</ul><!-- .breadcrumb -->

		<!-- <div class="nav-search" id="nav-search">
			<form class="form-search">
				<span class="input-icon">
					<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
					<i class="icon-search nav-search-icon"></i>
				</span>
			</form>
		</div><!-- #nav-search -->
	</div>

	<div class="page-content">
		<div class="page-header">
			<h1>
					留言列表
			</h1>
		</div><!-- /.page-header -->

		<div class="row">
			<div class="col-xs-12">
				<!-- PAGE CONTENT BEGINS -->
				<div class="row">
				<div class="col-xs-12 col-sm-12">
						<div class="widget-box">
							<div class="widget-header">
								<h4>查找留言</h4>

								<span class="widget-toolbar">

									<a href="#" data-action="collapse">
										<i class="icon-chevron-up"></i>
									</a>

									<a href="#" data-action="close">
										<i class="icon-remove"></i>
									</a>
								</span>
							</div>

							<div class="widget-body">
								<div class="widget-main">
									<form class="form-inline" role="form" id="form-signin" action="{:U('Message/index')}" method="get">
									  <div class="form-group">
									    <label class="sr-only">留言者</label>
									    <input type="text" name="name" class="form-control" id="name" placeholder="请输入留言人名称">
									  </div>

										<div class="form-group">
											<label class="sr-only">所属乡镇</label>
											<select class="form-control" name="message_cat_id" id="form-field-select-1">
													<option value="">全部乡镇</option>
												<volist name="cats" id="vo">
													<option value="{$vo.cat_id}" <if condition="$_GET['message_cat_id'] eq $vo['cat_id']">selected="selected"</if>>{$vo.cat_name}</option>
												</volist>
											</select>
										</div>


										<!--<div class="form-group">
											<label class="sr-only">审核状态</label>
											<select class="form-control" name="message_type" id="video_typed">
													<option value="" selected="selected">全部</option>
													<option value="0" <if condition="$_GET['message_type'] eq '0'">selected="selected"</if>>已审核</option>
													<option value="1" <if condition="$_GET['message_type'] eq 1">selected="selected"</if>>未审核</option>
											</select>
										</div>-->



									  <button type="submit" class="btn btn-sm btn-warning">查找</button>
										

									</form>

								</div>
							</div>
						</div>
					</div>
				</div>



				<div class="row">
					<div class="col-xs-12">
						<div class="table-responsive">
							<table id="sample-table-1" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<!-- <th class="center">
											<label>
												<input type="checkbox" class="ace" />
												<span class="lbl"></span>
											</label>
										</th> -->
										<th>ID</th>
										<th>留言人</th>
										<th>联系方式</th>
										<th>所在村组</th>
										<th>期望开设的课程</th>
										<th>留言内容</th>
										<th>留言时间</th>
										<th>操作</th>
									</tr>
								</thead>

								<tbody>
									<tr>
										<!-- <td class="center">
											<label>
												<input type="checkbox" class="ace" />
												<span class="lbl"></span>
											</label>
										</td> -->
										<empty name="result">
		                    <td colspan="99" style="text-align:center" class="danger"> <strong><i class="fa fa-meh-o"></i>
		                            &nbsp;&nbsp;当前条件下没有数据</strong>
		                    </td>
		                    <else />
		                    <volist name="result" id="data">
										<tr>
										<td>{$data.message_id}</td>
										<td>{$data.name}</td>
										<td>{$data.contact}</td>
										<td>{$data.cat_name}</td>
										<td>{$data.section}</td>
										<td>{$data.content}</td>
										<td>{$data.message_uptime|date='Y-m-d H:i:s',###}</td>
										<td>
											<button class="btn btn-sm <if condition = "$data['message_type'] eq 1">btn-warning<else/>btn-primary</if> check-btn" data-id="{$data.message_id}" data-type="{$data.message_type}">
												<i class="icon-bell bigger-110"></i>
												<span class="bigger-110 no-text-shadow"><if condition = "$data['message_type'] eq 0">已审核<else/>未审核</if></span>
											</button>
										</td>
										
										
										</tr>
									</volist>
							</empty>

						<tr>
								<td colspan="99" style="text-align:center">
										<ul class="pagination">{$pageView}</ul>
								</td>
						</tr>


					</tbody> 
				</table>
			</div><!-- /.table-responsive -->
		</div><!-- /span -->
	</div><!-- /row -->


<import file="js.jquery#ui#widget" />
<import file="js.jquery#iframe-transport" />
<import file="js.jquery#fileupload" />
<script>
	var url = "__URL__/uploadImg";
	$('#fileupload').fileupload({
		url: url,
		dataType: 'json',
		done: function (e, data) {
			if(data.result.state == 1){
				layer.alert(data.result.msg, {
					icon: 1,
					skin: 'layer-ext-moon'
				})
				$("#pic_show").attr("src","__PUBLIC__/data/img/"+data.result.url);
				$("#pic").val(data.result.url);
			}else{
				layer.alert(data.result.msg, {
					icon: 2,
					skin: 'layer-ext-moon'
				})
				
			}
		},
		progressall: function (e, data) {
			var progress = parseInt(data.loaded / data.total * 100, 10);
			$('#progress .progress-bar').css(
				'width',
				progress + '%'
			);
		}
	}).prop('disabled', !$.support.fileInput)
		.parent().addClass($.support.fileInput ? undefined : 'disabled');

</script>

<script>


$("#form-signins").ajaxForm({
		dataType:'json',
		clearForm:false,
		beforeSerialize:function(){
				if ($('#teacher_names').val() == '' || $('#teacher_cat_id').val() == '') {
						layer.alert("必须输入留言名称,并选择留言的村组!", {
							icon: 2,
							skin: 'layer-ext-moon'
						})
						return false;
				}
		},
		
		success:function(data){
				if (data.state == 100) {
					layer.alert(data.msg, {
						icon: 1,
						skin: 'layer-ext-moon'
					})
					setTimeout(function(){window.location.reload();},2000);
				} else {
					layer.alert(data.msg, {
						icon: 2,
						skin: 'layer-ext-moon'
					})

				}
		}
});

		

		$(".del").click(function(){
				var obj = $(this);
				var message_id = $(this).attr("data-id");
				
				layer.confirm('确认要进行删除该留言 ？', {
					btn: ['确认','取消'] //按钮
				}, function(){
					$.ajax({
						type: "POST",
						url:  '{:U("Teacher/del_teacher")}',
						data: {message_id:message_id},
						dataType: "json",
						success: function(data){
							if(data.state==100){
								layer.msg(data.msg, {icon: 1});
								obj.parent().parent().parent().remove();
							}else{
								layer.msg(data.msg, {icon: 2});
							}
						}
					});
				}, function(){

				});


			})


				
				$(".check-btn").click(function(){
				var obj = $(this);
				var message_id = $(this).attr("data-id");
				var message_type = $(this).attr("data-type");
				if(message_type == 0){
					message_type = 1;
				}else{
					message_type = 0;
				}
				layer.confirm('确认要进行该操作 ？', {
					btn: ['确认','取消'] //按钮
				}, function(){
					$.ajax({
						type: "POST",
						url:  '{:U("Message/MessageType")}',
						data: {message_id:message_id,message_type:message_type},
						dataType: "json",
						success: function(data){
							if(data.state==100){
								layer.msg(data.msg, {icon: 1});
								if(message_type==0){
										obj.removeClass("btn-warning");
										obj.addClass("btn-primary");
										obj.attr('data-type',0);
										obj.children('span').text('已审核');
								}else{
									obj.removeClass("btn-primary");
									obj.addClass("btn-warning");
									obj.attr('data-type','1');
									obj.children('span').text('未审核');
								}
							
							}else{
								layer.msg(data.msg, {icon: 2});
							}
						}
					});
				}, function(){

				});


			})

		



			
</script>


